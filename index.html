<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>DataVault - Recherche</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <button id="theme-toggle">ðŸŒ™ Mode Sombre</button>
    <div style="margin-top: 100px; text-align: center;">
        <h1>DataVault</h1>
        <div class="search-container">
            <input type="search" id="site-search" placeholder="Rechercher un fichier...">
            <div id="suggestions" class="suggestions-box" style="display: none;"></div>
        </div>
    </div>

    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        
        function applyTheme() {
            if (localStorage.getItem('dark-mode') === 'enabled') {
                document.body.classList.add('dark-mode');
                toggleBtn.textContent = "â˜€ï¸ Mode Clair";
            }
        }

        toggleBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark ? 'enabled' : 'disabled');
            toggleBtn.textContent = isDark ? "â˜€ï¸ Mode Clair" : "ðŸŒ™ Mode Sombre";
        });

        applyTheme();

        // Logique de recherche (Registry)
        let availableFiles = [];
        fetch('registry.json').then(r => r.json()).then(data => availableFiles = data);

        const searchInput = document.getElementById('site-search');
        const suggestionsBox = document.getElementById('suggestions');

        searchInput.addEventListener('input', () => {
            const val = searchInput.value.toLowerCase();
            suggestionsBox.innerHTML = '';
            if (val.length < 2) { suggestionsBox.style.display = 'none'; return; }
            
            const matches = availableFiles.filter(f => f.alias.toLowerCase().includes(val));
            matches.forEach(file => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.innerHTML = `<strong>${file.alias}</strong>`;
                div.onclick = () => {
                    window.location.href = `viewer.html?file=${encodeURIComponent(file.path)}&alias=${encodeURIComponent(file.alias)}&owner=${encodeURIComponent(file.owner)}&author=${encodeURIComponent(file.author)}`;
                };
                suggestionsBox.appendChild(div);
            });
            suggestionsBox.style.display = matches.length ? 'block' : 'none';
        });
    </script>
</body>
</html>
