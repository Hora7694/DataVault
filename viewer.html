<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Visualiseur - DataVault</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div style="padding: 20px;">
        <button onclick="window.history.back()">← Retour</button>
        <h1 id="title">Chargement...</h1>
        <p id="meta" style="color: #888;"></p>
    </div>

    <div id="table-container" style="padding: 20px;"></div>

    <footer style="text-align: center; padding: 40px; border-top: 1px solid #eee;">
        <p>Base de données créée par <strong id="author">...</strong></p>
        <p>Données de <span id="owner">...</span> &copy; Tous droits réservés.</p>
    </footer>

    <script>
        const params = new URLSearchParams(window.location.search);
        const filePath = params.get('file');

        if (filePath) {
            document.getElementById('title').textContent = params.get('alias');
            document.getElementById('author').textContent = params.get('author');
            document.getElementById('owner').textContent = params.get('owner');
            document.getElementById('meta').textContent = "Source : " + filePath;

            fetch(filePath)
                .then(res => res.text())
                .then(csvText => {
                    const rows = csvText.split('\n').filter(r => r.trim() !== '');
                    let html = '<table border="1" style="width:100%; border-collapse:collapse;">';
                    
                    rows.forEach((row, index) => {
                        const tag = (index === 0) ? 'th' : 'td';
                        html += '<tr>';
                        row.split(',').forEach(cell => {
                            html += `<${tag} style="padding:10px;">${cell.replace(/"/g, '')}</${tag}>`;
                        });
                        html += '</tr>';
                    });
                    document.getElementById('table-container').innerHTML = html + '</table>';
                })
                .catch(err => {
                    document.getElementById('table-container').innerHTML = "Erreur de chargement du fichier CSV.";
                });
        }
    </script>
</body>
</html>
