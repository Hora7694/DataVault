<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualiseur - DataVault</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div style="padding: 20px;">
        <button onclick="window.history.back()" class="btn-back">← Retour</button>
        <div style="display: flex; align-items: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
            <h1 id="display-alias" style="margin: 0;">Chargement...</h1>
            <a id="download-btn" href="#" download><button class="btn-download">Télécharger CSV</button></a>
        </div>
        <p id="display-path" style="color: #888; font-size: 0.85em; font-family: monospace;"></p>
    </div>

    <div id="table-container" style="padding: 20px; overflow-x: auto;"></div>

    <footer style="text-align: center; padding: 40px; border-top: 1px solid #eee; font-size: 0.85em; color: #888; line-height: 1.8;">
        <p>Base de données créée par <strong id="display-author">...</strong></p>
        <div style="margin: 20px 0;">
            <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
            <script type='text/javascript'>
                kofiwidget2.init('Soutenir DataVault', '#5553ff', 'T6T117BAZT');
                kofiwidget2.draw();
            </script>
        </div>
        <p>Données de <span id="display-owner">...</span> &copy; Tous droits réservés.</p>
        <p>&copy; 2025 &bull; <a href="legale.html" style="color: #5553ff; text-decoration: none;">Mentions Légales</a></p>
    </footer>

    <script>
        async function loadCSV() {
            const params = new URLSearchParams(window.location.search);
            const path = params.get('file');
            if (!path) return;

            document.getElementById('display-alias').textContent = params.get('alias') || "Fichier";
            document.getElementById('display-path').textContent = path;
            document.getElementById('display-owner').textContent = params.get('owner') || "l'auteur";
            document.getElementById('display-author').textContent = params.get('author') || "Admin";
            document.getElementById('download-btn').href = path;

            try {
                const response = await fetch(path);
                const text = await response.text();
                const rows = text.split(/\r?\n/).filter(r => r.trim() !== '');
                
                let html = '<table><thead><tr>';
                const headers = rows[0].split(',');
                headers.forEach(h => html += `<th>${h.replace(/"/g, '')}</th>`);
                html += '</tr></thead><tbody>';

                rows.slice(1).forEach(row => {
                    html += '<tr>';
                    row.split(',').forEach(c => html += `<td>${c.replace(/"/g, '')}</td>`);
                    html += '</tr>';
                });
                document.getElementById('table-container').innerHTML = html + '</tbody></table>';
            } catch (err) {
                document.getElementById('table-container').innerHTML = "Erreur de chargement.";
            }
        }
        loadCSV();
    </script>
</body>
</html>
