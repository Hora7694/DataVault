<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Visualiseur - DataVault</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <button id="theme-toggle">üåô Mode Sombre</button>
    <div style="padding: 20px;">
        <button onclick="window.history.back()" style="padding: 10px; cursor: pointer;">‚Üê Retour</button>
        <h1 id="display-alias" style="text-align: left; margin-top: 20px;">Chargement...</h1>
        <div id="table-container" style="overflow-x: auto; margin-top: 20px;"></div>
    </div>

    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        if (localStorage.getItem('dark-mode') === 'enabled') {
            document.body.classList.add('dark-mode');
            toggleBtn.textContent = "‚òÄÔ∏è Mode Clair";
        }

        toggleBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark ? 'enabled' : 'disabled');
            toggleBtn.textContent = isDark ? "‚òÄÔ∏è Mode Clair" : "üåô Mode Sombre";
        });

        async function loadCSV() {
            const container = document.getElementById('table-container');
            const urlParams = new URLSearchParams(window.location.search);
            const filePath = urlParams.get('file');
            
            if (!filePath) { container.innerHTML = "Erreur: Fichier non sp√©cifi√©."; return; }
            document.getElementById('display-alias').textContent = urlParams.get('alias');

            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error("Fichier introuvable sur le serveur.");
                const text = await response.text();
                const rows = text.split('\n').filter(r => r.trim());

                let html = '<table><thead><tr>';
                const headers = rows[0].split(',');
                headers.forEach(h => html += `<th>${h.replace(/"/g, '')}</th>`);
                html += '</tr></thead><tbody>';

                rows.slice(1).forEach(row => {
                    html += '<tr>';
                    const cells = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); // Regex pour ignorer les virgules dans les guillemets
                    cells.forEach(c => {
                        let val = c.trim().replace(/"/g, '');
                        if (/\s{2,}/.test(val)) {
                            val = val.replace(/\s{2,}/g, ', ');
                            html += `<td><span class="tag-pill">${val}</span></td>`;
                        } else {
                            html += `<td>${val}</td>`;
                        }
                    });
                    html += '</tr>';
                });
                container.innerHTML = html + '</tbody></table>';
            } catch (e) { container.innerHTML = "Erreur de chargement : " + e.message; }
        }
        loadCSV();
    </script>
</body>
</html>
